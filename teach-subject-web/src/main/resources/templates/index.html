<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>专业管理</title>
</head>
<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="/ztree/zTreeStyle.css">
<script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="/layer/layer.js"></script>
<script src="/ztree/jquery.ztree.all-3.5.min.js"></script>
<style type="text/css">
    .header
    {
        width: 99%;
        height: 43px;
        background: #96b97d;
        line-height: 40px;
    }
    .col-sm-2
    {
        position: relative;
        min-height: 1px;
        padding-right: 0px;
        padding-left: 0px;
        top: 0px;
        left: 0px;
    }
    div.col-sm-10
    {
        position: relative;
        min-height: 1px;
        padding-right: 2px;
        padding-left: 2px;
        top: 0px;
        left: 0px;
    }
    h2
    {
        margin-top: 0px;
    }
    .panel-group
    {
        background: #dff0d8;
    }
    .panel-default > .panel-heading
    {
        color: #333;
        background-color: #dff0d8;
        border-color: #ddd;
    }
    .nav-pills > li.active > a, .nav-pills > li.active > a:focus, .nav-pills > li.active > a:hover
    {
        color: #333333;
        background-color: #dff0d8;
    }
    a
    {
        color: #333333;
        text-decoration: none;
    }
</style>
<script type="text/javascript">
    $(function () {
        var divId = localStorage.getItem("id");
        $("#" + divId + "").addClass('in');
        var liId = localStorage.getItem("liId");
        $("#" + liId + "").addClass('active');

        $(".panel-body ul li a").click(function () {
            var all_lis = $(this).parents("div").find(".in");
            var id = all_lis[0].id;
            var parent = $(this).parent(); // 父节点
            var liId = parent[0].id;
            localStorage.setItem("liId", liId);
            localStorage.setItem("id", id);
        })
    })
</script>

</head>
<body>
<!--上部-->
<div class="header">
    <center>
        <h2>
            后台管理系统</h2>
    </center>
</div>

<!--左侧-->
<div class="col-md-2">
    <div class="panel-group" id="accordion">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">学员管理</a></h4>
            </div>
            <div id="collapseOne" class="panel-collapse collapse">
                <div class="panel-body">
                    <ul class="nav nav-pills nav-stacked">
                        <li id="dbdz"><a href="http://127.0.0.1:2001/index">学员列表</a></li>
                        <li id="ycllr"><a href="http://127.0.0.1:2001/excel">批量开通学员</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">讲师管理</a></h4>
            </div>
            <div id="collapseTwo" class="panel-collapse collapse">
                <div class="panel-body">
                    <ul class="nav nav-pills nav-stacked">
                        <li id="jgdx1"><a href="http://127.0.0.1:3001/teacher/index">讲师列表</a></li>
                        <li id="ghsgl"><a href="http://127.0.0.1:3001/teacher/add">添加讲师</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree">专业管理</a></h4>
            </div>
            <div id="collapseThree" class="panel-collapse collapse">
                <div class="panel-body">
                    <ul class="nav nav-pills nav-stacked">
                        <li id="kcgl"><a href="http://127.0.0.1:4001/subject/index">专业课程</a></li>

                    </ul>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseFour">课程管理</a></h4>
            </div>
            <div id="collapseFour" class="panel-collapse collapse ">
                <div class="panel-body">
                    <ul class="nav nav-pills nav-stacked">
                        <li id="yaopinflow2"><a href="http://127.0.0.1:5001/course/index">课程列表</a></li>
                        <li id="qyxxwh"><a href="http://127.0.0.1:5001/course/add">添加课程</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseFive">系统管理</a></h4>
            </div>
            <div id="collapseFive" class="panel-collapse collapse">
                <div class="panel-body">
                    <ul class="nav nav-pills nav-stacked">
                        <li id="yhgl"><a href="#">操作员管理</a></li>
                        <li id="gzbm"><a href="#">工作部门</a></li>
                        <li id="xtsz2"><a href="#">系统信息维护</a></li>
                        <li id="changePwd"><a href="#">密码修改</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!--右侧-->
<div class="col-md-10">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title"><i class="glyphicon glyphicon-th"></i> 数据列表</h3>
        </div>
        <div class="panel-body">
            <button type="button" id="professor" class="btn btn-info">增加专业</button>
            <!--ztree-->
            <div class="panel-body">
                <ul id="treeDemo" class="ztree"></ul>
            </div>

        </div>
    </div>
</div>
</body>
<script type="text/javascript">

   function textDom(treeId, treeNode) {
       var textObj = $("#" + treeNode.tId + "_a");

       if ($("#diyBtn_"+treeNode.id).length>0) return;
       if (treeNode.sort == null){
           treeNode.sort = 0;
       }
       var editStr = "&nbsp;&nbsp;排序：<input type='text' value='"+treeNode.sort+"' class='' id='"
               + treeNode.id + "'  onchange='changeOrder(this.value, this.id)' maxlength='6' style='width:25px;height:15px;'/>";
       textObj.append(editStr);

   }

   function changeOrder(value,id) {
       console.log(value+"======="+id);
       var url ="/subject/changeSort";
       var params = {"id":id, "value":value};
       $.post(url, params, function (result) {
           if (result == "success"){
               layer.msg("修改成功", {time:1000, icon:6, shift:6});
           }else{
               layer.msg("修改失败", {time:1000, icon:5, shift:6});
           }
       });
   }
   var treeObj = null;
  $(function () {
      var setting = {
          data: {
              key: {
                  name: "subjectName"
              }
          },
          view: {
              addDiyDom : textDom
          },
          /*edit: {
              enable: true,
              showRemoveBtn: false,
              showRenameBtn: false
          },*/
          callback: {
              onRename: zTreeOnRename,
              onDblClick: zTreeOnDblClick
          }
      };
      
      $.ajax({
          url:"/subject/zt",
          type:"post",
          success:function(result){
              treeObj = $.fn.zTree.init($("#treeDemo"), setting, result.data);
          }
      });
  })

    $("#professor").click(function () {
       var nodes = treeObj.getSelectedNodes();
       if (nodes.length == 0){
           var childZNode = new ZtreeNode(null, id, "新建专业");
           treeObj.addNodes(null, childZNode, true);
           return;
       }

       var id = nodes[0].id;

       var node = treeObj.getNodeByParam("id",id, null);
       if (node.parentId == 0){
           //添加根节点
           var childZNode = new ZtreeNode(null, id, "新建课程"); //构造子节点
           treeObj.addNodes(node, childZNode, true);
       }else {
           //添加子节点
           var no = treeObj.getNodeByParam("id",id, null);
           var childZNode = new ZtreeNode(null, id, "新建子课程"); //构造子节点
           treeObj.addNodes(no, childZNode, true);

       }
       console.log(node);
    });


   function ZtreeNode(id, pId, name) {//定义ztree的节点类
       this.id = id;
       this.pId = pId;
       this.subjectName = name;
       this.value = '';
   }

   //名字改变触发事件
   function zTreeOnRename(event, treeId, treeNode, isCancel) {
//       treeObj.setEditable(false);

      var parentId = treeNode.parentId;
      var id = treeNode.id;
      var subjectId = treeNode.subjectId;
      var subjectName =  treeNode.subjectName;
        /*0 210 210 公务*/
       console.log(parentId+"====="+id+"==="+subjectId+"==="+subjectName);
       var url = "/subject/rename";
       var params = {"id":id, "parentId":parentId,"subjectName":subjectName};
       $.post(url,params,function (result) {
           if (result == "success"){
               layer.msg("修改成功", {time:1000, icon:6, shift:6});
               window.location.href="http://127.0.0.1:4001/subject/index"
           }else{
               layer.msg("修改失败", {time:1000, icon:5, shift:6});
           }
       });
   }

    //双击事件
   function zTreeOnDblClick(event, treeId, treeNode) {
//       treeObj.setEditable(true);
       var id = treeNode.id;
       var node = treeObj.getNodeByParam("id",id, null);
       treeObj.editName(node);
   };
</script>
</html>